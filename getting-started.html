<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Getting Started - rust-eos</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="ayu">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><a href="getting-help.html"><strong aria-hidden="true">2.</strong> Getting Help</a></li><li><a href="installation.html"><strong aria-hidden="true">3.</strong> Installation</a></li><li><ol class="section"><li><a href="install-rust.html"><strong aria-hidden="true">3.1.</strong> Install Rust</a></li><li><a href="install-eos.html"><strong aria-hidden="true">3.2.</strong> Install EOS</a></li><li><a href="optional-dependencies.html"><strong aria-hidden="true">3.3.</strong> Optional Dependencies</a></li></ol></li><li><a href="quick-start.html"><strong aria-hidden="true">4.</strong> Quick Start</a></li><li><a href="getting-started.html" class="active"><strong aria-hidden="true">5.</strong> Getting Started</a></li><li><a href="examples/index.html"><strong aria-hidden="true">6.</strong> Examples</a></li><li><ol class="section"><li><a href="examples/hello-world.html"><strong aria-hidden="true">6.1.</strong> Hello, World!</a></li><li><a href="examples/tic-tac-toe.html"><strong aria-hidden="true">6.2.</strong> Tic-Tac-Toe</a></li><li><a href="examples/addressbook.html"><strong aria-hidden="true">6.3.</strong> Address Book</a></li><li><a href="examples/url-shortener.html"><strong aria-hidden="true">6.4.</strong> URL Shortener</a></li></ol></li><li><a href="roadmap.html"><strong aria-hidden="true">7.</strong> Roadmap</a></li><li><a href="api-documentation.html"><strong aria-hidden="true">8.</strong> API Documentation</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">rust-eos</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#getting-started" id="getting-started"><h1>Getting Started</h1></a>
<p>In this section we will walk through writing the <a href="https://github.com/EOSIO/eosio.cdt/tree/master/examples/hello"><code>hello</code> C++ example</a> in Rust. In this example you will learn how to setup and optimize a basic smart contract, accept an input, and print to the console.</p>
<a class="header" href="#creating-the-project" id="creating-the-project"><h4>Creating the project</h4></a>
<p>First, let's create a new project with Cargo and change directories:</p>
<pre><code class="language-sh">cargo +nightly new hello --lib
cd hello
</code></pre>
<p>You should now have a directory that looks like this:</p>
<pre><code>src/
  lib.rs
Cargo.toml
</code></pre>
<a class="header" href="#configuring-cargo" id="configuring-cargo"><h4>Configuring Cargo</h4></a>
<p>The <code>Cargo.toml</code> file is used by Rust to manage dependencies and other configuration options. If you open this file now it should look similar to this:</p>
<pre><code class="language-toml">[package]
name = &quot;hello&quot;
version = &quot;0.1.0&quot;
authors = []
edition = &quot;2018&quot;

[dependencies]
</code></pre>
<p>Let's change this to add <code>eosio</code> as a dependency, and change the crate type so that Rust generates a <code>.wasm</code> file:</p>
<pre><code class="language-toml">[package]
name = &quot;hello&quot;
version = &quot;0.1.0&quot;
authors = []
edition = &quot;2018&quot;

[lib]
crate-type = [&quot;cdylib&quot;]

[dependencies]
eosio = &quot;0.2&quot;
</code></pre>
<a class="header" href="#generating-and-optimizing-a-wasm-file" id="generating-and-optimizing-a-wasm-file"><h4>Generating and Optimizing a WASM File</h4></a>
<p>At this point we can compile our project to produce a <code>.wasm</code> file:</p>
<pre><code class="language-sh">cargo build --release --target=wasm32-unknown-unknown
</code></pre>
<p>You should now see a generated file at <code>target/wasm32-unknown-unknown/release/hello.wasm</code>:</p>
<pre><code>$ ls -lh target/wasm32-unknown-unknown/release | grep wasm
-rwxr-xr-x 2 sagan sagan 1.9M Oct 25 16:34 hello.wasm
</code></pre>
<p>This file will be huge at almost 2MB! But we can <em>significantly</em> reduce file size by enabling link-time optimization. Add this to the bottom of our <code>Cargo.toml</code> file:</p>
<pre><code class="language-toml">[profile.release]
lto = true
</code></pre>
<p>Now if we rebuild the project we should see a much smaller <code>.wasm</code> file:</p>
<pre><code>$ cargo build --release --target=wasm32-unknown-unknown
$ ls -lh target/wasm32-unknown-unknown/release | grep wasm
-rwxr-xr-x 2 sagan sagan  52K Oct 25 16:48 hello_world.wasm
</code></pre>
<p>That's better, but 52KB is still heavy for an empty smart contract. Luckily we can use <code>wasm-gc</code> and <code>wasm-opt</code> to reduce the file size even further:</p>
<pre><code class="language-sh">wasm-gc target/wasm32-unknown-unknown/release/hello.wasm hello_gc.wasm
wasm-opt hello_gc.wasm --output hello_gc_opt.wasm -Oz
</code></pre>
<pre><code>$ ls -lh | grep wasm
-rw-r--r-- 1 sagan sagan  109 Oct 25 16:57 hello_gc_opt.wasm
-rw-r--r-- 1 sagan sagan  116 Oct 25 16:56 hello_gc.wasm
</code></pre>
<p>By using <code>wasm-gc</code> and <code>wasm-opt</code> we are able to get the file size down to just over 100 bytes! But this is before we've added any code. Realistically you can expect simple contracts to be under 15KB.</p>
<a class="header" href="#writing-the-smart-contract" id="writing-the-smart-contract"><h4>Writing the Smart Contract</h4></a>
<p>Now that we know how to prepare the <code>.wasm</code> file, let's start coding. Open up <code>src/lib.rs</code> and replace its contents with this:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
use eosio::*;                       // Include everything from the eosio crate

#[eosio_action]                     // Mark this function as an action
fn hi(name: AccountName) {
    eosio_print!(&quot;Hello, &quot;, name);  // Print to the console
}

eosio_abi!(hi);                     // Create the 'apply' function
#}</code></pre></pre>
<p>See the <a href="https://sagan-software.github.io/rust-eos/">API documentation</a> for more details on what this code is doing.</p>
<p>Let's recompile our project and minify the the WASM file again:</p>
<pre><code class="language-sh">cargo build --release --target=wasm32-unknown-unknown
wasm-gc target/wasm32-unknown-unknown/release/hello.wasm hello_gc.wasm
wasm-opt hello_gc.wasm --output hello_gc_opt.wasm -Oz
</code></pre>
<a class="header" href="#creating-the-abi-file" id="creating-the-abi-file"><h4>Creating the ABI File</h4></a>
<p>In the future ABI files will be <a href="#abi-generation">automatically generated</a>, but for now they must be typed out manually. Copy this code into a file called <code>hello.abi.json</code>:</p>
<pre><code class="language-json">{
    &quot;version&quot;: &quot;eosio::abi/1.0&quot;,
    &quot;structs&quot;: [
        {
            &quot;name&quot;: &quot;hi&quot;,
            &quot;base&quot;: &quot;&quot;,
            &quot;fields&quot;: [
                {
                    &quot;name&quot;: &quot;name&quot;,
                    &quot;type&quot;: &quot;name&quot;
                }
            ]
        }
    ],
    &quot;actions&quot;: [
        {
            &quot;name&quot;: &quot;hi&quot;,
            &quot;type&quot;: &quot;hi&quot;
        }
    ]
}
</code></pre>
<a class="header" href="#deploying-first-attempt" id="deploying-first-attempt"><h4>Deploying, First Attempt</h4></a>
<p>At this point we have our WASM and ABI files, so we're ready to deploy our smart contract.</p>
<p>For this you will need to have access to an EOS node. Please see the <a href="#installing-eos">Installing EOS</a> section for instructions. The code below will assume that you've started <code>nodeos</code> and <code>keosd</code> containers using Docker Compose.</p>
<p>First create an alias for <code>cleos</code>:</p>
<pre><code class="language-sh">alias cleos='docker-compose exec keosd cleos --url http://nodeosd:8888 --wallet-url http://127.0.0.1:8900'
</code></pre>
<p>Then create a wallet, import a private key, and create the <code>hello</code> account:</p>
<pre><code class="language-sh">PUBKEY=EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV
PRIVKEY=5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3
cleos wallet create --to-console
cleos wallet import --private-key $PRIVKEY
cleos create account eosio hello $PUBKEY $PUBKEY
</code></pre>
<p>Deploy the ABI:</p>
<pre><code class="language-sh">cleos set abi hello /mnt/dev/project/hello.abi.json
</code></pre>
<p>Deploy the WASM:</p>
<pre><code class="language-sh">cleos set code hello /mnt/dev/project/hello_gc_opt.wasm
</code></pre>
<p>...but this will <strong>fail</strong> with an error!</p>
<pre><code>$ cleos set code hello /mnt/dev/project/hello_gc_opt.wasm
Reading WASM from /mnt/dev/project/hello_gc_opt.wasm...
Setting Code...
Error 3070002: Runtime Error Processing WASM
</code></pre>
<p>In the <code>nodeos</code> console log you will see this error message:</p>
<pre><code>error 2018-10-26T03:46:12.176 thread-0  http_plugin.cpp:580           handle_exception     ] FC Exception encountered while processing chain.push_transaction
debug 2018-10-26T03:46:12.176 thread-0  http_plugin.cpp:581           handle_exception     ] Exception Details: 3070002 wasm_execution_error: Runtime Error Processing WASM
Smart contract data segments must lie in first 64KiB
     {&quot;k&quot;:64}
     thread-0  wasm_eosio_validation.cpp:30 validate
pending console output:
     {&quot;console&quot;:&quot;&quot;}
     thread-0  apply_context.cpp:72 exec_one
</code></pre>
<p>This is happening because Rust by default reserves 1MB for the stack, but EOS expects data to be <a href="https://github.com/EOSIO/eos/issues/5604">within the first 64KB</a>.</p>
<a class="header" href="#deploying-second-attempt" id="deploying-second-attempt"><h4>Deploying, Second Attempt</h4></a>
<p>We can fix this by telling the Rust compiler to reserve less than 64KB for the stack. Create a new file at <code>.cargo/config</code> with these contents:</p>
<pre><code class="language-toml">[target.wasm32-unknown-unknown]
rustflags = [
  &quot;-C&quot;, &quot;link-args=-z stack-size=48000&quot;
]
</code></pre>
<p>48KB seems to be a reasonable number, but feel free to experiment.</p>
<p>Now let's try to rebuild and redeploy our contract:</p>
<pre><code class="language-sh">cargo build --release --target=wasm32-unknown-unknown
wasm-gc target/wasm32-unknown-unknown/release/hello.wasm hello_gc.wasm
wasm-opt hello_gc.wasm --output hello_gc_opt.wasm -Oz
cleos set code hello /mnt/dev/project/hello_gc_opt.wasm
</code></pre>
<p>Finally, say hello:</p>
<pre><code class="language-sh">cleos push action hello hi '[&quot;world&quot;]' -p 'hello@active'
</code></pre>
<a class="header" href="#success" id="success"><h4>Success!</h4></a>
<p>If all went well you should see <code>Hello, world</code> in the console. Otherwise, if the transaction was sent successfully but you don't see any output, you may need to use the <code>--contract-console</code> option with <code>nodeos</code>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="quick-start.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="examples/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="quick-start.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="examples/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
